# サードパーティクッキーについて理解する

## 課題1

サードパーティクッキーとファーストパーティクッキーの主な違いは、どのドメインがクッキーを設定するかという点にある。

**ファーストパーティクッキー**：

- ウェブサイトを訪れたユーザーが直接アクセスしているドメインによって設定されるクッキー
- 一般的には、ユーザーのログイン情報やショッピングカートの内容を保持するために使用される
- ユーザーのエクスペリエンスを向上させるために役立つ

**サードパーティクッキー**：

- ユーザーが訪れているウェブサイトとは異なるドメインによって設定されるクッキー
- 主に広告業者などがユーザーの閲覧行動を追跡し、パーソナライズされた広告を提供するために使用される
- プライバシーの懸念から、一部のブラウザや規制機関が制限を設ける動きがある

このように、ファーストパーティクッキーはユーザーの利便性向上に直接貢献する一方、サードパーティクッキーは主にマーケティング目的で使用される点が大きな違いである。


サードパーティ Cookie を用いて広告配信ネットワーク（例えばGoogle AdSense など）がユーザの訪問履歴を把握する方法について説明してみる。
広告配信ネットワークは、サードパーティ Cookie を利用してユーザーのインターネット上での行動を追跡する。具体的なプロセスは以下の通り：
1. Cookie の設定：ユーザーがウェブサイトを訪れると、そのサイトに埋め込まれた広告ネットワークのスクリプトが実行され、サードパーティ Cookie がユーザーのブラウザに設定されます。この Cookie には一意の識別子が含まれる。
2. データの収集：サードパーティ Cookie により、ユーザーが訪れる複数のウェブサイトにおける行動データが収集される。これには訪問したページ、クリックしたリンク、閲覧したコンテンツなどが含まれる。
3. データの統合：収集されたデータは広告配信ネットワークのサーバーに送信され、そこで統合・解析されます。これにより、ユーザーの興味や嗜好に関するプロファイルが作成される。
4. パーソナライズド広告の配信：作成されたプロファイルに基づいて、ユーザーに最適化された広告が他のウェブサイトを訪れる際に表示される。これにより、広告の効果が最大化される。


このようにして、サードパーティ Cookie を用いた広告配信ネットワークはユーザーの訪問履歴を把握し、パーソナライズされた広告を提供することができる。


サードパーティクッキーは、ユーザーが訪れているウェブサイトとは異なるドメインによって生成される。

1. **画像埋め込み**：
    - ウェブページに広告主などのサードパーティが提供する画像が埋め込まれると、その画像がホストされているドメインからクッキーが生成される
    - この画像リクエストにより、サードパーティのサーバーはユーザーのブラウザにクッキーを設定できる
2. **スクリプト埋め込み**：
    - ウェブページにサードパーティのJavaScriptが埋め込まれることがあります。これにより、スクリプトを提供するドメインからクッキーが生成される
    - スクリプトは複数の機能を持ち、ユーザーの行動を追跡したり、広告を表示したりすることができる
3. **iframe埋め込み**：
    - ウェブページにサードパーティのコンテンツがiframeとして埋め込まれることがある。このiframe内のコンテンツは異なるドメインから供給され、そのドメインがクッキーを設定する。
    - iframeは独立したブラウザコンテキストとして扱われるため、サードパーティのクッキーを生成するのに適している

これらの手法を通じて、サードパーティクッキーはユーザーのブラウザに設定され、ユーザーのオンライン行動を追跡するために使用される。

サードパーティクッキーの扱いはブラウザによって異なる模様。

### Safari

- **Intelligent Tracking Prevention (ITP)**: Safariは2017年にITPを導入し、サードパーティクッキーの使用を厳しく制限している。ITPは機械学習を使用してトラッキングを行うドメインを特定し、これらのドメインのクッキーを一定期間後に削除する。最新のバージョンでは、すべてのサードパーティクッキーがデフォルトでブロックされる

### Chrome

- **Privacy Sandbox**: Google Chromeは2023年にサードパーティクッキーを段階的に廃止する計画を発表した。代わりに、ユーザーのプライバシーを保護しつつ広告を提供するための新しい技術（例：Federated Learning of Cohorts）を導入しようとしている

### Firefox

- **Enhanced Tracking Protection (ETP)**: FirefoxはETPを導入し、既定でサードパーティクッキーをブロックする設定になっている。ETPは、ユーザーのプライバシーを保護するためにトラッキングドメインを特定し、これらのクッキーをブロックする

### Edge

- **Tracking Prevention**: Microsoft Edgeは、ユーザーが選択できる複数のトラッキング防止レベルを提供している。「バランス」モードや「厳格」モードでは、サードパーティクッキーが制限されるか完全にブロックされる

このように、各ブラウザがユーザーのプライバシーを保護するために異なるアプローチを採用しており、特にSafariはサードパーティクッキーに対して最も厳格な制限を導入している

ドメインが同一でポートが異なるクッキーはファーストパーティクッキーである。クッキーの分類では、ポート番号の違いは考慮されず、ドメインが基準となる。

## 課題2

[サードパーティクッキーを実装してみる](https://github.com/UR-deR/nodejs-express-playground/commit/da9ef9ed1259f8b43e0cfd08d20616026faaf1c2)にて対応
